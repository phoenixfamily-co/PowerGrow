<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
<script src="https://kit.fontawesome.com/1228ed801f.js" crossorigin="anonymous"></script>
<link rel="stylesheet" href="https://static.neshan.org/sdk/mapboxgl/v1.13.2/neshan-sdk/v1.0.8/index.css" />
<script src="https://static.neshan.org/sdk/mapboxgl/v1.13.2/neshan-sdk/v1.0.8/index.js"></script>

        <title>PowerGrow</title>
    <style>

        	@font-face {
			font-family: BYekan;
  			font-style: normal;
  			font-weight: normal;
  			src: url("/static/fonts/BYekan.eot");/* IE9 Compat Modes */
			src: url("/static/fonts/BYekan.woff") format('woff'),
        		 url("/static/fonts/BYekan.woff") format('woff2'), /* Super Modern Browsers */
        		 url("/static/fonts/BYekan.ttf")  format('truetype') /* Safari, Android, iOS */
		}
        * {
            box-sizing: border-box
        }

            body {
                margin: 0;
                font-family: "Poppins", sans-serif;
                display: flex;
                justify-content: center;
                align-items: center;
                flex-direction: column;
                background: #282a36;
                height: 100vh;
                color: #fff;
            }


            .otp-field {
                flex-direction: row;
                column-gap: 10px;
                display: flex;
                align-items: center;
                justify-content: center;
            }

            .otp-field input {
                width: 45px;
                font-size: 32px;
                padding: 10px;
                text-align: center;
                border-radius: 5px;
                margin: 2px;
                border: 2px solid #55525c;
                background: #21232d;
                font-weight: bold;
                color: #fff;
                outline: none;
                transition: all 0.1s;
            }

            .otp-field input:focus {
                border: 2px solid #E16539;
                box-shadow: 0 0 2px 2px #E165396a;
            }

            .disabled {
                opacity: 0.5;
                cursor: none;
                pointer-events: none;
            }

             .logoHolder {
                 position: absolute;
                 top: 0;
                 justify-items: center;
                 justify-content: center;
                 margin-top: 1%;
                 display: inline-flex;
                 direction: ltr;
             }

        .logo {
            width: 50px;
            height: 50px;
            border-radius: 25px;
            direction: ltr

        }

        .typography {
            margin-top: 10px;
            color: white;
            margin-left: 10px;
            font-size: 20px

        }

</style>

</head>

<body>

<div class="logoHolder">

    <img alt="" src="/media/{{ about.logo }}" class="logo">
    <div class="typography">PowerGrow</div>

</div>


<h1>کد تاییدیه را وارد کنید</h1>
<div class="otp-field">
    <label>
        <input type="text" maxlength="1" />
    </label>
    <label>
        <input type="text" maxlength="1" />
    </label>
    <label>
        <input class="space" type="text" maxlength="1" />
    </label>
    <label>
        <input type="text" maxlength="1" />
    </label>
    <label>
        <input type="text" maxlength="1" />
    </label>
    <label>
        <input type="text" maxlength="1" />
    </label>
</div>
            <p class="resend text-muted mb-0">
              کد را دریافت نکردید؟ <a href='javascript:location.reload()'>ارسال مجدد</a>
            </p>

</body>


<script>

    const verificationForm = document.getElementById('verificationForm');
    const code = document.getElementById('otp');
    const number = {{ number }};
    const param = {'is_active' : 'True'};
    const otp = {{ response|safe }};

    const inputs = document.querySelectorAll(".otp-field label input");

    inputs.forEach((input, index) => {
        input.dataset.index = index;
        input.addEventListener("keyup", handleOtp);
        input.addEventListener("paste", handleOnPasteOtp);

    });

function handleOtp(e) {
    const input = e.target;
    let value = input.value;
    let isValidInput = value.match(/[0-9a-z]/gi);
    input.value = "";
    input.value = isValidInput ? value[0] : "";
    let fieldIndex = input.dataset.index;
    if (fieldIndex < inputs.length - 1 && isValidInput) {
        input.nextElementSibling.focus();
    }
    if (e.key === "Backspace" && fieldIndex > 0) {
        input.previousElementSibling.focus();
    }
    if (fieldIndex === inputs.length - 1 && isValidInput) {
        submit();
    }
}
function handleOnPasteOtp(e) {
    const data = e.clipboardData.getData("text");
    const value = data.split("");
    if (value.length === inputs.length) {
        inputs.forEach((input, index) => (input.value = value[index]));
        submit();
    }
}
async function submit() {
    console.log("Submitting...");
    // 👇 Entered OTP
    let otp = "";
    inputs.forEach((input) => {
        otp += input.value;
        input.disabled = true;
        input.classList.add("disabled");
    });
    console.log(otp);


    if (parseInt(otp.code) === parseInt(code.value)){

    const response = await fetch('../api/'+'+'+number+'/' , {
        method: 'GET',
        headers: {
            'Content-Type': 'application/json',
        },
    });
    if (response.status===200){
        window.location.assign("../password/"+'+'+number)
    }else if (response.status===401) {
        const result = await fetch('../api/'+'+'+number+'/activate/', {
        method: 'PUT',
        headers: {
            'Content-Type': 'application/json',
        },
            body:JSON.stringify(param)
    });
        if (result.status===200){
                    window.location.assign("{% url 'user:login' %}")
        }
        else {
            alert(response.statusText)
        }
    }
    }
    else {
        alert("کد وارد شده تادرست است")
    }
}

</script>


</html>