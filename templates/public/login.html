{% load static %}
<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="csrf-token" content="{{ csrf_token }}">

<script src="https://kit.fontawesome.com/f872c5c890.js" crossorigin="anonymous"></script>
    <link rel="stylesheet" href="https://static.neshan.org/sdk/mapboxgl/v1.13.2/neshan-sdk/v1.0.8/index.css" />
<script src="https://static.neshan.org/sdk/mapboxgl/v1.13.2/neshan-sdk/v1.0.8/index.js"></script>

        <title>ورود به باشگاه ورزشی حجاب</title>

    {% load bootstrap5 %}
    {% bootstrap_css %}
    {% bootstrap_javascript %}

    <style>

        	@font-face {
			font-family: BYekan;
  			font-style: normal;
  			font-weight: normal;
  			src: url("/static/fonts/BYekan.eot");/* IE9 Compat Modes */
			src: url("/static/fonts/BYekan.woff") format('woff'),
        		 url("/static/fonts/BYekan.woff") format('woff2'), /* Super Modern Browsers */
        		 url("/static/fonts/BYekan.ttf")  format('truetype') /* Safari, Android, iOS */
		}
            html, body {
                margin: 0;
                padding: 0 ;
                height: 100%;
                overflow-x: hidden;
                background-color: #f7f0e8;
                font-family: BYekan, serif !important;
        }

            body{
                min-height: 100%;
                display: flex;
                flex-direction: column;
         }

            footer{
                bottom: 0;
                margin-top: auto; /* این خط را اضافه کنید */
            }

       .logoHolder {
            width: 100%;
            position: absolute;
            margin-top: 20px;
            left: 0;
            display: flex;
            z-index: 10 !important;
            direction: ltr;
            align-items: center;
            justify-content: center;

        }


        .logo {
            width: 50px;
            height: 50px;
            border-radius: 25px;

        }

        .typography {
            color: black;
            font-size: 20px;
            margin-left: 10px;

        }


         .dropdown-content a {
            color: white;
            padding: 5px 16px;
            font-size: 16px;
            text-decoration: none;
            display: block;
        }


         .dropdown-menu li a {
            color: white ;
             width: 100% ;
             text-align: right
        }

        /* Change color of dropdown links on hover */
        .dropdown-menu li a:hover {
            background-color: black ;
        }

        .navbar-nav > li > .dropdown-menu {
            background-color: #312f2e;
        }


        .btn {
            background-color: #E16539;
            border-color: transparent;
            color: white;
            cursor: pointer;
        }

        .navbar{
            direction: rtl;
            background: #312f2e;
        }

        .navbar-nav > li {
            margin-left: 20px;
            margin-right: 20px;
        }

        .navbar-nav > li a {
            color: white !important;
            text-decoration: none;
       }

        .navbar-nav > li a:hover{
            color: gray !important;
       }

        .nav-link.active {
            color: #E16539!important;
        }

        .nav-link.disabled {
            color: #EBEBE4!important;
        }

input[type=text], input[type=password] {
  width: 100%;
  padding: 12px 20px;
  margin: 8px 0;
  display: inline-block;
  border: transparent;
  background: lightgray;
  box-sizing: border-box;
}

button:hover {
  opacity: 0.8;
}

</style>

</head>

<body>

<nav class="navbar navbar-dark navbar-expand-lg w-100 ">

  <!-- Toggler/collapsibe Button -->
  <button style="outline: none; box-shadow: none;" class="navbar-toggler justify-content-center" type="button" data-toggle="collapse" data-bs-toggle="collapse"   data-target="#collapsibleNavbar" data-bs-target="#collapsibleNavbar" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
    <span class="" role="button" ><i class="fa fa-bars" aria-hidden="true" style="color:#e6e6ff"></i></span>
</button>
  <!-- Navbar links -->
  <div class="collapse navbar-collapse" id="collapsibleNavbar">
    <ul class="nav navbar-nav">
  <li class="nav-item">
    <a class="nav-link" aria-current="page" href='{% url 'home:home' %}'>صفحه اصلی</a>
  </li>
  <li class="nav-item dropdown">
    <a class="nav-link dropdown-toggle" data-bs-toggle="dropdown" href="#" role="button" aria-expanded="false">ورزش ها</a>
    <ul class="dropdown-menu">
         {% for x in sport %}
             <li><a class="dropdown-item" href="{% url 'product:category' x.id %}">{{ x.title }}</a></li>
         {% endfor %}
    </ul>
  </li>
  <li class="nav-item disabled">
    <a class="nav-link disabled" href="{% url 'reservation:reservation' %}">اجاره سالن</a>
  </li>
  <li class="nav-item">
    <a class="nav-link" href='{% url 'about:aboutUs'%}'>درباره ما</a>
  </li>

     <li class="nav-item">
    <a class="nav-link active" href='{% url 'user:login' %}'>ورود و عضویت</a>
  </li>
</ul>
  </div>
</nav>

<div class="logoHolder">

    <img alt="" src="{% get_media_prefix%}{{ about.logo }}" class="logo">
    <div class="typography">PowerGrow</div>

</div>

 <div class="container py-5 h-100 mt-5">
    <div class="row d-flex justify-content-center align-items-center h-100">
        <div class="col-12 col-md-8 col-lg-6 col-xl-5">
            <div class="card text-white" style="border-radius: 1rem ; background-color: #312f2e ">
                <div class="card-body p-5 text-center">
                    <h2 class="fw-bold mb-2 text-uppercase">ورود</h2>
                    <p class="text-white-50 mb-4">لطفا اطلاعات خود را وارد کنید</p>
                    {% csrf_token %}
                    <form>
                        <div class="form-outline form-white mb-4">
                            <input type="tel" id="number" class="form-control form-control-lg" placeholder="9123456780" required />
                            <label class="form-label" for="number">موبایل</label>
                        </div>

                        <div class="form-outline form-white mb-4 position-relative">
                            <input type="password" id="password" class="form-control form-control-lg" placeholder="رمز عبور" required />
                            <label class="form-label" for="password">رمز عبور</label>
                            <span id="togglePassword" class="position-absolute" style="right: 15px ; top: 40%; transform: translateY(-40%); cursor: pointer;">
                                <i class="fa fa-eye" aria-hidden="true" style="color: black"></i>
                            </span>
                        </div>

                        <p class="small mb-4">
                            <a class="text-white-50" href="{% url 'user:forget' %}">فراموشی رمز عبور؟</a>
                        </p>
                        <button id="submit" class="btn btn-outline-light btn-lg px-5" type="submit">ورود</button>
                    </form>

                    <p class="mt-4 mb-0">اکانت ندارید؟
                        <a href="{% url 'user:register' %}" class="text-white-50 fw-bold">ثبت نام کنید</a>
                    </p>
                </div>
            </div>
        </div>
    </div>
</div>



<footer class="text-white pt-4">
    <div class="container-fluid p-0">
        <div class="row align-items-center py-4" dir="rtl" style="background-color: #312f2e">
            <!-- Info Section -->
            <div class="col-md-4">
                <ul class="list-unstyled">
                    <li class="mb-5">
                        <div class="d-flex align-items-start">
                            <i class="fa-solid fa-location-dot fa-2x mr-3"></i>
                            <h5 class="mb-0 me-2">{{ about.address|linebreaksbr }}</h5>
                        </div>
                    </li>
                    <li class="mb-5">
                        <div class="d-flex align-items-start">
                            <i class="fa-solid fa-phone-flip fa-2x mr-3"></i>
                            <h5 class="mb-0 me-2">{{ about.phone }}<br>{{ about.telephone }}</h5>
                        </div>
                    </li>
                    <li class="mb-2">
                        <div class="d-flex align-items-start">
                            <i class="fa-brands fa-instagram fa-2x mr-3"></i>
                            <h5 class="mb-0 me-2">{{ about.instagram }}</h5>
                        </div>
                    </li>
                </ul>
            </div>

            <!-- Map Section -->
            <div class="col-md-4 d-flex justify-content-center mb-4">
                <div id="map" class="img-fluid bg-light" style="width: 60%; height: 250px;"></div>
            </div>

            <!-- Logo Section -->
            <div class="col-md-4 text-center mb-4">
                <h3>PowerGrow</h3>
                <img class="img-fluid mb-3" style="max-width: 200px; height: auto" src="/media/{{ about.transparent_logo }}" alt="Logo">
            </div>
        </div>

        <!-- Copyright Section -->
        <div class="row bg-dark">
            <div class="col-md-12 d-flex justify-content-between align-items-center py-3">
                <a class="mb-0 ms-3" href="https://abbaslotfinasab.com/" style="color: white; text-decoration: none" target="_blank">&copy; <span id="year">2023</span> AbbasLotfinasab, All rights reserved.</a>

                <div class="d-flex align-items-center ms-auto">
                    <span class="d-inline me-1">Follow us:</span>
                    <a href="//www.instagram.com/abbas_lotfinasab?igsh=MmVlMjlkMTBhMg==" class="text-white ms-2 me-2">
                        <i class="fa-brands fa-instagram fa-2x"></i>
                    </a>
                    <a href="//www.linkedin.com/in/abbaslotfinasab" class="text-white ms-2 me-2">
                        <i class="fa-brands fa-linkedin fa-2x"></i>
                    </a>
                </div>
            </div>
        </div> <!-- این div را برای بستن copyright اضافه کنید -->
    </div>
</footer>


<script>
    const togglePassword = document.getElementById('togglePassword');
    const passwordInput = document.getElementById('password');

    togglePassword.addEventListener('click', function () {
        const type = passwordInput.getAttribute('type') === 'password' ? 'text' : 'password';
        passwordInput.setAttribute('type', type);
        this.querySelector('i').classList.toggle('fa-eye-slash');
    });
</script>


<script>

    let lat = {{ about.latitude }};
    let long =     {{ about.longitude }};

    const map = new nmp_mapboxgl.Map({
        mapType: nmp_mapboxgl.Map.neshanVector,
        container: "map",
        zoom: 15,
        pitch: 0,
        center: [long, lat],
        minZoom: 2,
        maxZoom: 21,
        trackResize: false,
        mapKey: "web.3c30ab5c27a242d19aab4bca4e973288",
        poi: true,
        traffic: true,
        mapTypeControllerStatus: {
            show: false,
        }
    });
</script>


<script>

   document.addEventListener('DOMContentLoaded', () => {
       const submit = document.getElementById('submit');
       let redirectUrl;


    if (submit) { // چک کردن وجود دکمه
        submit.addEventListener('click', async (event) => {
            event.preventDefault(); // جلوگیری از ارسال پیش‌فرض فرم

            const username = '+98' + document.getElementById('number').value.trim()
            const password = document.getElementById('password').value

            console.log(username)
            console.log(password)


            try {

                const csrfToken = document.querySelector('meta[name="csrf-token"]').getAttribute('content');

                const response = await fetch("{% url 'user:login_api' %}", {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-CSRFToken': csrfToken, // اضافه کردن CSRF token

                    },
                    body: JSON.stringify({ username: username, password: password }) // ارسال username و password
                });
                const result = await response.json();
                JSON.stringify(result)

                if (response.ok) { // چک کردن وضعیت پاسخ
                    JSON.stringify(result)

                    const userRole = result.user

                    if (!userRole) {
                        alert("کاربری یافت نشد");
                        return;
                    }

                    const userId = userRole.id; // شناسه کاربر
                    // دسترسی به ویژگی‌ها
                    const isStaff = userRole.is_staff;
                    const isSuperuser = userRole.is_superuser;
                    const isTeacher = userRole.is_teacher;
                    if (isStaff) {
                        redirectUrl = `/user/home/manager/${userId}/`;
                    } else if (isSuperuser) {
                        redirectUrl = `/user/home/admin/${userId}/`;
                    } else if (isTeacher) {
                        redirectUrl = `/user/home/teacher/${userId}/`;
                    } else {
                        redirectUrl = `/user/home/user/${userId}/`;
                    }
                    window.location.assign(redirectUrl);
                } else {
                    alert("نام کاربری یا پسورد اشتباه است");
                }
            } catch (error) {
                console.error("Error during login:", error);
                alert("خطایی در ارتباط با سرور پیش آمد. لطفاً دوباره تلاش کنید.");
            }

        });
    } else {
        console.error("Submit button not found");
    }
});
</script>

</body>
</html>
