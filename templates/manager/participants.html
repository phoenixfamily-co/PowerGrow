<!DOCTYPE html>
<html lang="fa">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ثبت شرکت‌کنندگان</title>
    <link href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">

    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.6/dist/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>

    <style>

         body {
            text-align: right;  /* راست‌چین کردن متن */
            background: #312f2e;
        }

         .logoHolder {
            width: 100%;
            position: relative;
            margin-top: 20px;
            left: 0;
            display: flex;
            z-index: 10 !important;
            direction: ltr;
            align-items: center;
            justify-content: center;

        }

        .logo {
            width: 50px;
            height: 50px;
            border-radius: 25px;

        }

        .typography {
            color: white;
            font-size: 20px;
            margin-left: 10px;

        }

         .form-control {
             text-align: right;  /* راست‌چین کردن متن در فیلدهای فرم */
         }

         label {
        color: white;  /* تغییر رنگ متن لیبل به سفید */
    }
          .custom-btn {
            background-color: #E16539; /* رنگ دلخواه */
            border: none; /* حذف حاشیه */
              color: white;
        }
        .custom-btn:hover {
               background-color: #a84e2c; /* تغییر رنگ در حالت hover */
               color: #c4c4c4; /* رنگ برای حالت هاور */
        }
        .margin-bottom {
            margin-bottom: 20px; /* فاصله از پایین */
        }

        .container {
            margin-top: 50px;
        }

        .autocomplete-items {
            position: absolute;
            border: 1px solid #d3d3d3;
            border-bottom: none;
            border-top: none;
            z-index: 99;
            max-height: 150px; /* حداکثر ارتفاع لیست */
            overflow-y: auto; /* اسکرول عمودی */
            background-color: white; /* پس‌زمینه */
            width: calc(100% - 2px); /* عرض برابر با ورودی به علاوه حاشیه */
            box-sizing: border-box; /* شامل حاشیه در اندازه */
        }

        .autocomplete-items div {
            padding: 10px; /* فضای داخلی */
            cursor: pointer; /* نشانگر ماوس */
        }

        .autocomplete-items div:hover {
            background-color: #e9e9e9; /* تغییر رنگ در هاور */
        }

    </style>
</head>
<body>

<div class="logoHolder">

    <img alt="" src="/media/{{ about.logo }}" class="logo">
    <div class="typography">PowerGrow</div>

</div>

<div class="container">
        <form id="participant-form">
            <div class="form-group">
                <label for="title">:عنوان</label>
                <input type="text" class="form-control" id="title" value="{{ course.title }}" required>
            </div>
            <div class="form-group">
                <label for="description">:توضیحات</label>
                <textarea class="form-control" id="description" rows="3" required></textarea>
            </div>
            <div class="form-group">
                <label for="session">:تعداد جلسه</label>
                <select class="form-control" id="session" required>
                    <option value="" disabled selected>انتخاب کنید</option>
                     {% for x in course.sessions.all %}
                            <option dir="rtl" value="{{ x.id }}">{{ x.number }}  جلسه </option>
                        {% endfor %}
                </select>
            </div>
            <div class="form-group">
                <label for="day">:روزها هفته</label>
                <select class="form-control" id="day" required>
                    <option value="" disabled selected>انتخاب کنید</option>
                    {% for x in day %}
                            <option dir="rtl" value="{{ x.id }}">{{ x.title }} {{ x.session }} جلسه </option>
                        {% endfor %}
                </select>
            </div>
            <div class="form-group">
                <label for="startDay">:روز شروع</label>
                <select class="form-control" id="startDay" required>
                    <option value="">انتخاب کنید</option>
                    <!-- گزینه‌های روزهای شروع باید با جاوااسکریپت پر شوند -->
                </select>
            </div>
            <div class="form-group">
                <label for="endDay">:روز پایان</label>
                <select class="form-control" id="endDay" required>
                    <option value="">انتخاب کنید</option>
                    <!-- گزینه‌های روزهای پایان باید با جاوااسکریپت پر شوند -->
                </select>
            </div>
            <div class="form-group">
                <label for="price">:قیمت</label>
                <input type="number" class="form-control" id="price" required>
            </div>
            <div class="form-group">
                <label for="user">:کاربر</label>
                <input class="form-control" dir="ltr" id="user" type="number" name="user" placeholder="شماره همراه : 9123456789">
            </div>
            <button type="submit" class="btn custom-btn margin-bottom">ثبت</button>
        </form>
    </div>

    <script>
        // جاوااسکریپت برای پر کردن گزینه‌ها
        // اینجا باید API ها را برای دریافت داده‌های جلسات، روزها و دوره‌ها فراخوانی کنی و گزینه‌ها را پر کنی
        // به عنوان مثال:
        document.addEventListener('DOMContentLoaded', function () {
            // مثال برای پر کردن گزینه‌ها
            const sessionSelect = document.getElementById('session');
            const daySelect = document.getElementById('day');
            // ...و همینطور برای دیگر فیلدها
        });

        // ارسال فرم
        document.getElementById('participant-form').addEventListener('submit', function(event) {
            event.preventDefault();
            // جمع‌آوری داده‌ها و ارسال به API
            const data = {
                title: document.getElementById('title').value,
                description: document.getElementById('description').value,
                session: document.getElementById('session').value,
                day: document.getElementById('day').value,
                startDay: document.getElementById('startDay').value,
                endDay: document.getElementById('endDay').value,
                price: document.getElementById('price').value,
                user: document.getElementById('user').value,
                course: document.getElementById('course').value
            };

            fetch('/api/manager/participations/', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(data)
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    alert('شرکت‌کننده با موفقیت ثبت شد!');
                    // فرم را پاک کن یا به صفحه دیگر برو
                } else {
                    alert('خطا: ' + data.error);
                }
            })
            .catch(error => {
                console.error('Error:', error);
            });
        });
    </script>


<script>
    async function getAllUser() {
        const userList = [];
        let phone

        {% for x in user.all %}
            phone = "{{ x.number }}".replace("+98", "");
            userList.push(phone);
        {% endfor %}

        autocomplete(document.getElementById("user"), userList);
    }

    function autocomplete(input, arr) {
        let currentFocus = -1;

        input.addEventListener("input", function() {
            closeAllLists();
            const val = this.value;

            if (!val) return false;

            const autocompleteList = createAutocompleteList(this);
            arr.forEach(item => {
                if (item.substr(0, val.length).toUpperCase() === val.toUpperCase()) {
                    const itemDiv = createAutocompleteItem(item, input);
                    autocompleteList.appendChild(itemDiv);
                }
            });
        });

        input.addEventListener("keydown", function(e) {
            const items = document.getElementById(this.id + "autocomplete-list").getElementsByTagName("div");
            if (items) {
                if (e.keyCode === 40) { // down
                    currentFocus++;
                    addActive(items);
                } else if (e.keyCode === 38) { // up
                    currentFocus--;
                    addActive(items);
                } else if (e.keyCode === 13) { // enter
                    e.preventDefault();
                    if (currentFocus > -1) items[currentFocus].click();
                }
            }
        });

        document.addEventListener("click", function(e) {
            closeAllLists(e.target);
        });
    }

    function createAutocompleteList(input) {
        const div = document.createElement("DIV");
        div.setAttribute("id", input.id + "autocomplete-list");
        div.setAttribute("class", "autocomplete-items");
        input.parentNode.appendChild(div);
        return div;
    }

    function createAutocompleteItem(item, input) {
        const div = document.createElement("DIV");
        div.innerHTML = `<strong>${item.substr(0, input.value.length)}</strong>${item.substr(input.value.length)}`;
        div.innerHTML += `<input type='hidden' value='${item}'>`;
        div.addEventListener("click", function() {
            input.value = this.getElementsByTagName("input")[0].value;
            closeAllLists();
        });
        return div;
    }

    function addActive(items) {
        if (!items) return;
        removeActive(items);
        if (currentFocus >= items.length) currentFocus = 0;
        if (currentFocus < 0) currentFocus = items.length - 1;
        items[currentFocus].classList.add("autocomplete-active");
    }

    function removeActive(items) {
        for (let item of items) {
            item.classList.remove("autocomplete-active");
        }
    }

    function closeAllLists(exceptElement) {
        const items = document.getElementsByClassName("autocomplete-items");
        for (let i = 0; i < items.length; i++) {
            if (exceptElement !== items[i] && exceptElement !== inp) {
                items[i].parentNode.removeChild(items[i]);
            }
        }
    }

    // Run the getAllUser function when the document is fully loaded
    document.addEventListener("DOMContentLoaded", function() {
        getAllUser();
    });
</script>



</body>
</html>
